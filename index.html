<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Safloet Test Login</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; }
    #login-area { position: absolute; top: 1rem; right: 1rem; }
    pre { background: #f0f0f0; padding: 1rem; border-radius: 6px; }
    a.button {
      padding: 0.5rem 1rem;
      background: #5865F2;
      color: white;
      text-decoration: none;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<h1>Safloet Test Environment</h1>

<div id="login-area"></div>

<h2>User Data</h2>
<pre id="userdata">Not logged in</pre>

<script>
async function updateLoginArea() {
  const loginArea = document.getElementById("login-area");
  const userData = document.getElementById("userdata");

  try {
    const res = await fetch("https://auth.safloetsystems.xyz/me", { credentials: "include" });
    const data = await res.json();

    if (data.logged_in) {
      // Show avatar, username, Discord ID
      loginArea.innerHTML = `
        <img src="${data.user.avatar_url}" alt="avatar" style="width:50px; border-radius:50%; vertical-align:middle;">
        <span>${data.user.username} (ID: ${data.user.id})</span>
        <a href="https://auth.safloetsystems.xyz/logout" class="button" style="margin-left:1rem;">Logout</a>
      `;
      userData.textContent = JSON.stringify(data.user, null, 2);
      window.currentUser = data.user;
    } else {
      // Not logged in â€” show login button
      loginArea.innerHTML = `
        <a href="https://auth.safloetsystems.xyz/login?next=https://test.safloetsystems.xyz" class="button">
          Login with Discord
        </a>
      `;
      userData.textContent = "Not logged in";
      window.currentUser = null;
    }
  } catch (err) {
    console.error("Failed to fetch login status", err);
    loginArea.innerHTML = `<span style="color:red;">Error loading login</span>`;
    userData.textContent = "Error fetching data";
  }
}

// Run on page load
updateLoginArea();
</script>

</body>
</html>
