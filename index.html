<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Safloet Test Environment</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      padding: 2rem; 
      background-color: #1e1b2f; /* dark purple background */
      color: #d8b4fe;           /* light purple text */
    }
    #login-area { position: absolute; top: 1rem; right: 1rem; }
    pre { 
      background: #3b0764;      /* darker purple for JSON box */
      padding: 1rem; 
      border-radius: 6px; 
      overflow-x: auto;
      color: #d8b4fe;
    }
    a.button {
      padding: 0.5rem 1rem;
      background: #7c3aed;       /* bright purple button */
      color: white;
      text-decoration: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    img.avatar { width: 50px; border-radius: 50%; vertical-align: middle; margin-right: 0.5rem; }
    h1, h2 { color: #c4b5fd; }
  </style>
</head>
<body>

<h1>Safloet Test Environment</h1>

<div id="login-area"></div>

<h2>User Data (JSON)</h2>
<pre id="userdata">Not logged in</pre>

<script>
async function updateLoginArea() {
  const loginArea = document.getElementById("login-area");
  const userData = document.getElementById("userdata");

  try {
    const res = await fetch("https://auth.safloetsystems.xyz/me", { credentials: "include" });
    const data = await res.json();

    if (data.logged_in) {
      // Show avatar, username, Discord ID, logout button
      loginArea.innerHTML = `
        <img class="avatar" src="${data.user.avatar_url}" alt="avatar">
        <span>${data.user.username} (ID: ${data.user.id})</span>
        <a id="logout-button" class="button" style="margin-left:1rem;">Logout</a>
      `;
      userData.textContent = JSON.stringify(data.user, null, 2);
      window.currentUser = data.user;

      document.getElementById("logout-button").addEventListener("click", async () => {
        await fetch("https://auth.safloetsystems.xyz/logout", { credentials: "include" });
        window.currentUser = null;
        updateLoginArea(); // refresh UI
      });

    } else {
      // Not logged in â€” show login button
      loginArea.innerHTML = `
        <a href="https://auth.safloetsystems.xyz/login?next=https://test.safloetsystems.xyz" class="button">
          Login with Discord
        </a>
      `;
      userData.textContent = "Not logged in";
      window.currentUser = null;
    }
  } catch (err) {
    console.error("Failed to fetch login status", err);
    loginArea.innerHTML = `<span style="color:red;">Error loading login</span>`;
    userData.textContent = "Error fetching data";
  }
}

// Run on page load
updateLoginArea();
</script>

</body>
</html>
